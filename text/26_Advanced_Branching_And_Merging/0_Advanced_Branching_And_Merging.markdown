## Продвинутая работа с ветками и слиянием ##

### Получение помощи решения конфликтов во время слияния ###

Все изменения которые git способен слить автоматически уже добавлены в директорию заморозки, так что linkgit:git-diff[1] показывает только конфликты. Эта команда использует необычный синтаксис:

    $ git diff
    diff --cc file.txt
    index 802992c,2b60207..0000000
    --- a/file.txt
    +++ b/file.txt
    @@@ -1,1 -1,1 +1,5 @@@
    ++<<<<<<< HEAD:file.txt
     +Hello world
    ++=======
    + Goodbye
    ++>>>>>>> 77976da35a11db4580b80ae27e8d65caf5208086:file.txt

Отменить тот коммит который коммит будет выполнен после того как мы разрешим этот конфликт будет иметь двух родителей вместо обычного одного: один родитель будет HEAD, конец текущей ветки; другой будет конец другой ветки, которая сохранится временно в MERGE_HEAD.

Во время слияния, директория заморозки содержит три версии каждого файла. Каждый их этих "замороженных файлов" представляет различную версию файла:

	$ git show :1:file.txt	# the file in a common ancestor of both branches
	$ git show :2:file.txt	# the version from HEAD.
	$ git show :3:file.txt	# the version from MERGE_HEAD.

Когда вы выполните linkgit:git-diff[1] вы увидите конфликты, он выполняется в три-пути diff между конфликтовавшем результатами слияния в рабочем дереве с замороженым 2 и 3 чтобы показать только куски кода которых содержимое приходит из обоих сторон, смешанным (другими словами, когда результаты слияния целиком приходят из заморозки 2, эта часть не конфликтующая и не показывается. То же самое для заморозки 3).

Команда diff выше показывает отличия между версией рабочего дерева fie.txt и версиями заморозки 2 и заморозки 3. Таким образом предваряя каждую строку одним "+" или "-", теперь используются две колонки: первая колонка используется для отличий между первым родителем и копией рабочей директории и вторая для отличий между вторым родителем и копией рабочего дерева. (Просмотрите секцию "COMBINED DIFF FORMAT" linkgit:git-diff-files[1] для получения дополнительных подробностей формата.)

После улаживания конфликта очевидный способ (но перед обновлением директории заморозки), diff будет выглядеть след.образом:

    $ git diff
    diff --cc file.txt
    index 802992c,2b60207..0000000
    --- a/file.txt
    +++ b/file.txt
    @@@ -1,1 -1,1 +1,1 @@@
    - Hello world
    -Goodbye
    ++Goodbye world

Это показывает что наш улаженная версия удалена "Hello world" из первого родителя, удалена "Goodbye" из второго родителя, и добавлена "Goodbye world", которая до этого отсутствовала в обоих.

Некоторые особые параметры diff позволяют различать рабочую директорию от любых других этих этапов:

    $ git diff -1 file.txt		# diff against stage 1
    $ git diff --base file.txt	# same as the above
    $ git diff -2 file.txt		# diff against stage 2
    $ git diff --ours file.txt	# same as the above
    $ git diff -3 file.txt		# diff against stage 3
    $ git diff --theirs file.txt	# same as the above.

Команды linkgit:git-log[1] и linkgit:gitk[1] также имеюют специальную помощь для слияний:

    $ git log --merge
    $ gitk --merge

Это покажет все коммиты которые существуют только в HEAD или в MERGE_HEAD, и которые в затронуты в файле unmerged.

Вы можете также использовать linkgit:git-mergetool[1], которая позволяет вам сливать unmerged файлы используя внешние инструменты такие как emacs или kdiff3.

Каждый раз вы улаживает конфликты в файле и обновляйте директорию заморозки:

    $ git add file.txt

разные этапы этого файла будут "collapsed", после которого git-diff не будет более (по умолчанию) показывать отличия для этого файла.