<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
  "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
	<title>Git Book - Продвинутая работа с ветками и слиянием</title>
	<meta http-equiv="content-language" content="en">
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<link rel="icon" href="favicon.png" type="image/png">
	<link rel="stylesheet" href="assets/blueprint/screen.css" type="text/css" media="screen, projection">
  <link rel="stylesheet" href="assets/blueprint/print.css" type="text/css" media="print">
  <!--[if IE]><link rel="stylesheet" href="assets/blueprint/ie.css" type="text/css" media="screen, projection"><![endif]-->
	<link rel="stylesheet" href="assets/stylesheets/mac_classic.css" type="text/css" media="screen, projection">
	<link rel="stylesheet" href="assets/stylesheets/style.css" type="text/css" media="screen, projection">
</head>

<body>
<div class="container chapter showgrids">

  <div class="span-21 header">
    <div class="nav"><a href="5_Изменение_вашей_истории.html">Prev</a>  <a href="5_Поиск_проблем_-_git_bisect.html">Next</a></div>
    <div class="title"><a href='index.html'>Git Community Book</a></div>
  </div>
  
  <div class="span-21">
    <br/>
  </div>
  
  <div class="span-21">
    <h2>Продвинутая работа с ветками и слиянием</h2>

<h3>Получение помощи решения конфликтов во время слияния</h3>

<p>Все изменения которые git способен слить автоматически уже добавлены в индекс, так что <a href="http://www.kernel.org/pub/software/scm/git/docs/git-diff.html">git diff</a> показывает только конфликты. Эта команда использует необычный синтаксис:</p>

<pre><code>$ git diff
diff --cc file.txt
index 802992c,2b60207..0000000
--- a/file.txt
+++ b/file.txt
@@@ -1,1 -1,1 +1,5 @@@
++&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD:file.txt
 +Hello world
++=======
+ Goodbye
++&gt;&gt;&gt;&gt;&gt;&gt;&gt; 77976da35a11db4580b80ae27e8d65caf5208086:file.txt
</code></pre>

<p>Отменить коммит который будет выполнен после того как мы разрешим этот конфликт будет иметь двух родителей вместо обычного одного: один родитель будет HEAD, конец текущей ветки; другой будет конец другой ветки, которая сохранится временно в MERGE_HEAD.</p>

<p>Во время слияния, индекс содержит три версии каждого файла. Каждый их этих "проиндексированных файлов" представляет разную версию файла:</p>

<pre><code>$ git show :1:file.txt  # файл которой потомок обоих файлов из сливаемых ветвей
$ git show :2:file.txt  # версия из HEAD.
$ git show :3:file.txt  # версия и сливаемой ветки MERGE_HEAD.
</code></pre>

<p>Когда вы запросите <a href="http://www.kernel.org/pub/software/scm/git/docs/git-diff.html">git diff</a> показать конфликты, он запускает diff в три пути, между конфликтовавшем результом слияния в рабочем дереве с индексом 2 и 3 чтобы показать только те куски кода, содержимое которых приходит из обоих ветвей, смешанным (другими словами, когда результаты слияния целиком приходят только из индекса 2, то эта часть не конфликтующая и не показывается. То же самое для индекса 3).</p>

<p>Команда diff выше показывает отличия между версией рабочего дерева fie.txt и версиями индексов 2 и 3. Таким образом вместо того чтобы предварять каждую строку одним "+" или "-", теперь используются две колонки: первая колонка используется для отличий между первым родителем и копией рабочей директории и вторая для отличий между вторым родителем и копией рабочего дерева. (Просмотрите секцию "COMBINED DIFF FORMAT" <a href="http://www.kernel.org/pub/software/scm/git/docs/git-diff-files.html">git diff-files</a> для получения дополнительных подробностей формата.)</p>

<p>После улаживания конфликта очевидный способ (но перед обновлением индекса), diff будет выглядеть след.образом:</p>

<pre><code>$ git diff
diff --cc file.txt
index 802992c,2b60207..0000000
--- a/file.txt
+++ b/file.txt
@@@ -1,1 -1,1 +1,1 @@@
- Hello world
-Goodbye
++Goodbye world
</code></pre>

<p>Это показывает что наша исправленная версия удалила "Hello world" из первого родителя, удалила "Goodbye" из второго родителя, и добавила "Goodbye world", которая до этого отсутствовала в обоих.</p>

<p>Некоторые особые параметры diff позволяют выполнять diff рабочей директории от любых других этих индексов:</p>

<pre><code>$ git diff -1 file.txt      # diff against stage 1
$ git diff --base file.txt  # same as the above
$ git diff -2 file.txt      # diff against stage 2
$ git diff --ours file.txt  # same as the above
$ git diff -3 file.txt      # diff against stage 3
$ git diff --theirs file.txt    # same as the above.
</code></pre>

<p>Команды <a href="http://www.kernel.org/pub/software/scm/git/docs/git-log.html">git log</a> и <a href="http://www.kernel.org/pub/software/scm/git/docs/gitk.html">gitk</a> также предлагают специальную помощь для слияний:</p>

<pre><code>$ git log --merge
$ gitk --merge
</code></pre>

<p>Это покажет все коммиты которые существуют только в HEAD или в MERGE_HEAD, и которые затрагивают неслитый файл.</p>

<p>Вы можете также использовать <a href="http://www.kernel.org/pub/software/scm/git/docs/git-mergetool.html">git mergetool</a>, которая позволяет вам сливать неслитые файлы используя внешние инструменты такие как emacs или kdiff3.</p>

<p>Каждый раз как только вы разрешили конфликты в файле, обновите индекс:</p>

<pre><code>$ git add file.txt
</code></pre>

<p>и тогда разные версии этого файла в индексе будут "разрушены", после чего git-diff не будет более (по умолчанию) показывать diff-ы для этого файла.</p>

<h3>Множественное слияние</h3>

<p>Вы можете сливать несколько веток одновременно просто перечисляя их в <a href="http://www.kernel.org/pub/software/scm/git/docs/git-merge.html">git merge</a>. Например,</p>

<pre><code>$ git merge scott/master rick/master tom/master
</code></pre>

<p>что эквивалентно:</p>

<pre><code>$ git merge scott/master
$ git merge rick/master
$ git merge tom/master
</code></pre>

<h3>Поддерево</h3>

<p>Есть ситуации где вы захотите включить содержимое из стороннего проекта в свой собственный. Вы можете просто выполнить pull из другого проекта если нет конфликтов.</p>

<p>Проблемный случай это когда есть конфиликтующие файлы. Потенциальный кандидат это Makefiles и другие стандартные файлы. Вы можете слить эти файлы но скорее всего не захотите этого делать. Лучшее решение для этой проблемы это слить проект как его собственную поддиректорию. Это не поддерживается стратегией рекурсивного слияния, но просто выполнить pull не сработает.</p>

<p>То что вам нужно это стратегия слияния поддерева, которая поможет вам в таких ситуациях.</p>

<p>В этом примере, давайте скажем у вас есть репозиторий в /path/to/B (но это также может быть и URL если вы пожелаете). Вы хотите слить ветку master этого репозитория в поддиректорию dir-B в вашей текущей ветке.</p>

<p>Здесь последовательность команд которая вам нужна:</p>

<pre><code>$ git remote add -f Bproject /path/to/B (1)
$ git merge -s ours --no-commit Bproject/master (2)
$ git read-tree --prefix=dir-B/ -u Bproject/master (3)
$ git commit -m "Merge B project as our subdirectory" (4)
$ git pull -s subtree Bproject master (5)
</code></pre>

<p>Выгода от использования поддерева слияния это то что оно требует меньше административной заботы от пользователей вашего репозитория. Это работает со старшими (до Git v1.5.2) клиентами и у вас есть код сразу после клонирования.</p>

<p>Как бы там ни было если вы используете подмодули, то вы можете выбрать не перемещать объекты подмодулей. Это проблема возможна со слиянием поддерева.</p>

<p>Также, в случае если вы сделали изменения в другом проекте, проще предоставить изменения если вы используете подмодули.</p>

<p>(from <a href="http://www.kernel.org/pub/software/scm/git/docs/howto/using-merge-subtree.html">Using Subtree Merge</a>)</p>


  </div>
  
  <div class="span-21">
    <hr/>
    <div class="center"><a href="5_Изменение_вашей_истории.html">Prev</a>  <a href="5_Поиск_проблем_-_git_bisect.html">Next</a></div>
    <hr/>
  </div>
  
  <div class="span-17 footer">
  	<div class="menu">
  		This book is maintained by Scott Chacon, and hosting is donated by GitHub.
  		<br>
  		Please email me at <a href="mailto:schacon@gmail.com">schacon@gmail.com</a>
  		with patches, suggestions and comments.
	  </div>
  </div>
  <div class="span-4 last center">
    <a href="http://github.com"><img src="assets/images/github.png" alt="github logo"></a>
  </div>
  
</div>

<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-82337-12");
pageTracker._initData();
pageTracker._trackPageview();
</script>
<script src="http://static.getclicky.com/40584.js" type="text/javascript"></script>
<noscript><p><img alt="Clicky" src="http://in.getclicky.com/40584-db6.gif" /></p></noscript>

</body>
</html>
